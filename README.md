# Littorina population genetic analysis README
Littorina low coverage whole genome sequencing data analysis with R and ngsTools such as angsd

## Discription
This is a union of R scripts and shell scripts when analysing Littorina low coverage whole genome sequencing data. 
The analysis includes principal components analysis (PCA), admixture analysis, 1d and 2d site frequency spectrum (SFS) estimation, 
population genetic differentiation (fst and pbs) estimation, nucleotide diversity estimation, pairwise linkage disequilibrium (LD) 
estimation, LD decay fitting and LD heat map drawing. There are 3 directories including data, pictures and scripts.
- Data contains some of inputs and outputs of files in scripts.
- Pictures contains some of plots created by files in scripts.
- Scripts contains all of the coding used in Littorina population genetic analysis.

## Languages
Shell, R

## Dependencies
Softwares: samtools, ANGSD, PCAngsd, ngsAdmix, ngsLD

R packages: ggplot2, reshape2, tidyverse, readr, optparse, tools, plyr, stringr, gtools, LDheatmap

## Installation
Please download all of the files in a suitable directory and remember to change the absolute path of files in the scripts to a proper path on your computer.

## Project Structure and Usage
### Data
There are some necessary inputs data of scripts including some intermediate outputs.

### Pictures
Some example pictures.

### Scripts
**Please remember to run these shell scripts in a proper directory due to relative path of input files.**  
- all_pcangsd.sh: use PCAngsd to infer genomic covariance matrix from genotype likelihood data estimated by angsd. (use all_snp_pca.sh output as input)
- all_snp_pca.sh: use angsd to estimate genotype likelihood with bam files and then calculate genetic covariance matrix.
- angsd_snp_crab.sh: Use angsd to estimate genotype likelihood and SNP position in crab ecotype.
- angsd_snp_hybrid.sh: Use angsd to estimate genotype likelihood and SNP position in hybrid ecotype.
- angsd_snp_wave.sh: Use angsd to estimate genotype likelihood and SNP position in wave ecotype.
- create_chromo_contigs_list.R: use linkage map data to classify contigs list in every chromosome.
- create_ecotype_bam_files.sh: use output of draw_admixture_distinguish_ecotype.R to generate bam files absolute path in every ecotype.
- draw_1d_sfs.R: use outputs of sfs_folded_crab.sh, sfs_folded_hybrid.sh and sfs_folded_wave.sh to draw 1d folded sfs barplot.
- draw_2d_sfs.R: use outputs of sfs_2d_crab_hybrid.sh, sfs_2d_crab_wave.sh and sfs_2d_hybrid_wave.sh to draw 2d folded sfs heat map.
- draw_PCA.R: use output of all_pcangsd.sh and distance data to draw PCA scatter plot along with crab-hybrid-wave axis.
- draw_PCA_ecotype.R: use output of all_pcangsd.sh and ecotype data (output of draw_admixture_distinguish_ecotype.R) to draw PCA scatter plot whose colour represent ecotype category.
- draw_admixture_distinguish_ecotype.R: use output of ngsadmix.sh to draw barplot showing admixture proportion.
- draw_fst.R: use output of fst.sh and linkage map data to draw fst in every chromosome and ecotype pairwise in the order of contigs position on chromosome.
- draw_pbs.R: use output of fst.sh and linkage map data to draw sliding window pbs value in every chromosome and ecotype in the order of contigs position on chromsome.
- draw_pi.R: use output of fst.sh and linkage map data to draw sliding window pi value in every chromosome and ecotype in the order of contigs position on chromosome.
- fit_LDdecay.R: use output of ngsld_crab.sh, ngsld_hybrid.sh, ngsld_wave.sh and ld_files.list to fit LD decay line and draw a plot.
- fst.sh: use outputs of sfs_dosaf*.sh and sfs_2d*.sh scripts to estimate fst by realSFS function in angsd.
- ld_files_example.list: an example showing how ld_files.list (input of fit_LDdecay.R) should look like.
- ld_heatmap.R: use output of ngsld_*.sh scripts to draw heatmap in specific region of chromosome.
- lddecay.sh: a shell scripts running fit_LDdecay.R.
- ngsadmix.sh: use genotype likelihood file in beagle format (generated by angsd) to infer admixture proportions.
- ngsld_crab.sh: use prepared genotype likelihood file and SNP position file of crab ecotype to calculate LD by ngsLD software.
- ngsld_ecotype_prepare.sh: use outputs of angsd_snp*.sh to prepare genotype likelihood and SNP position data which are inputs of ngsLD.
- ngsld_hybrid.sh: use prepared genotype likelihood file and SNP position file of hybrid ecotype to calculate LD by ngsLD software.
- ngsld_wave.sh: use prepared genotype likelihood file and SNP position file of wave ecotype to calculate LD by ngsLD software.
- pbs.sh: use output of fst.sh to calculate sling window pbs value by realSFS function in angsd.
- sfs_2d_crab_hybrid.sh: use outputs of sfs_dosaf*.sh to estimate folded 2d crab-hybrid joint SFS matrix.
- sfs_2d_crab_wave.sh: use outputs of sfs_dosaf*.sh to estimate folded 2d crab-wave joint SFS matrix.
- sfs_2d_hybrid_wave.sh: use outputs of sfs_dosaf*.sh to estimate folded 2d hybrid-wave joint SFS matrix.
- sfs_dosaf_crab.sh: use angsd -doSaf to estimate SFS in crab ecotype.
- sfs_dosaf_hybrid.sh: use angsd -doSaf to estimate SFS in hybrid ecotype.
- sfs_dosaf_wave.sh: use angsd -doSaf to estimate SFS in wave ecotype.
- sfs_folded_crab.sh: use output of sfs_dosaf_crab.sh to estimate 1d folded sfs in crab ecotype.
- sfs_folded_hybrid.sh: use output of sfs_dosaf_hybrid.sh to estimate 1d folded sfs in hybrid ecotype.
- sfs_folded_wave.sh: use output of sfs_dosaf_wave.sh to estimate 1d folded sfs in wave ecotype.
- theta.sh: use angsd thetaStat function to estimate theta which represents population scaled mutation rate and nucleotide diversity.

## Author and contact
Rui Zhang   rui.zhang20@imperial.ac.uk
